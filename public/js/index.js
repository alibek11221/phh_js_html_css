function getTimeString(s){return s.toLocaleTimeString().replace(/(.*)\D\d+/,"$1")}conn.onopen=function(s){msg.type="init",conn.send(JSON.stringify(msg))},button.on("click",s=>{s.preventDefault();const n={type:"message",text:text.val()};text.val(""),conn.send(JSON.stringify(n))}),conn.onmessage=function(s){let n=JSON.parse(s.data);switch(n.type){case"init":let s;msg.id=n.id,n.data.map(n=>{let e=new Date(n.date.date);s!==e.getDate()&&(chat.append(`<div class="mb-1 lts-2px text-muted text-uppercase">${e.toLocaleDateString()}</div>`),s=e.getDate()),e=getTimeString(e),n.participantId===msg.id?chat.append(` <div class="msg right-msg">\n                                    <div class="msg-bubble">\n                                        <div class="msg-info">\n                                            <div class="msg-info-name">${n.name}</div>\n                                            <div class="msg-info-time">${e}</div>\n                                        </div>\n                                        <div class="msg-text">\n                                           ${n.text}\n                                        </div>\n                                    </div>\n                                </div>`):chat.append(`<div class="msg left-msg">\n                                <div class="msg-bubble">\n                                    <div class="msg-info">\n                                        <div class="msg-info-name">${n.name}</div>\n                                        <div class="msg-info-time">${e}</div>\n                                    </div>\n                                    <div class="msg-text">\n                                        ${n.text}\n                                    </div>\n                                </div>\n                            </div>`)}),chat.scrollTop(chat[0].scrollHeight);break;case"message":let e=new Date(n.message.date.date);e=getTimeString(e),n.message.participantId===msg.id?chat.append(` <div class="msg right-msg">\n                                    <div class="msg-bubble">\n                                        <div class="msg-info">\n                                            <div class="msg-info-name">${n.message.name}</div>\n                                            <div class="msg-info-time">${e}</div>\n                                        </div>\n                                        <div class="msg-text">\n                                           ${n.message.text}\n                                        </div>\n                                    </div>\n                                </div>`):chat.append(`<div class="msg left-msg">\n                                <div class="msg-bubble">\n                                    <div class="msg-info">\n                                        <div class="msg-info-name">${n.message.name}</div>\n                                        <div class="msg-info-time">${e}</div>\n                                    </div>\n                                    <div class="msg-text">\n                                        ${n.message.text}\n                                    </div>\n                                </div>\n                            </div>`),chat.animate({scrollTop:chat.prop("scrollHeight")},500)}},conn.onclose=(s=>{console.log(s)});